import{__esmMin as e,__toESM as t}from"./rolldown-runtime.js";import{init_dist as n,j as r,require_constants as i,require_jsx_runtime as a,require_react as o,require_react_reconciler as s}from"./react.js";import{ACESFilmicToneMapping as c,BasicShadowMap as l,Clock as u,Color as d,ColorManagement as f,CubeReflectionMapping as p,CubeTextureLoader as m,DRACOLoader as h,EXRLoader as g,EquirectangularReflectionMapping as _,GLTFLoader as v,GroundProjectedEnv as y,HalfFloatType as b,Layers as x,LinearSRGBColorSpace as S,MathUtils as C,MeshoptDecoder as w,NoToneMapping as ee,OrbitControls as te,OrthographicCamera as ne,PCFShadowMap as re,PCFSoftShadowMap as ie,PerspectiveCamera as ae,RGBAFormat as T,RGBELoader as oe,Raycaster as se,SRGBColorSpace as ce,Scene as le,Texture as E,TextureLoader as D,UnsignedByteType as O,VSMShadowMap as ue,Vector2 as de,Vector3 as k,WebGLCubeRenderTarget as A,WebGLRenderer as fe,init_three_module as j,init_three_stdlib as pe,three_module_exports as me}from"./three.js";import{GainMapLoader as he,HDRJPGLoader as ge,_extends as _e,c as ve,clear as ye,createWithEqualityFn as be,i as xe,init_camera_controls_module as Se,init_decode as Ce,init_dist as we,init_extends as Te,init_suspend_react as Ee,init_traditional as De,m as Oe,preload as ke,require_scheduler as Ae,suspend as je,x as Me}from"./index.js";function Ne(e){let t=e.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}function Pe(e){let t=L.useRef(e);return z(()=>void(t.current=e),[e]),t}function Fe(){let e=ve(),t=Me();return L.useMemo(()=>({children:n})=>{let r=!!xe(e,!0,e=>e.type===L.StrictMode),i=r?L.StrictMode:L.Fragment;return(0,R.jsx)(i,{children:(0,R.jsx)(t,{children:n})})},[e,t])}function Ie({set:e}){return z(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}function Le(e){var t;let n=typeof window<`u`?(t=window.devicePixelRatio)??2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}function M(e){var t;return(t=e.__r3f)?.root.getState()}function Re(e){let t={nodes:{},materials:{},meshes:{}};return e&&e.traverse(e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material),e.isMesh&&!t.meshes[e.name]&&(t.meshes[e.name]=e)}),t}function ze(e){for(let t in e.type!==`Scene`&&(e.dispose==null||e.dispose()),e){let n=e[t];n?.type!==`Scene`&&(n==null||n.dispose==null||n.dispose())}}function Be(e){let t={};for(let n in e)Ft.includes(n)||(t[n]=e[n]);return t}function Ve(e,t,n,r){let i=e,a=i?.__r3f;return a||(a={root:t,type:n,parent:null,children:[],props:Be(r),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=a)),a}function He(e,t){let n=e[t];if(!t.includes(`-`))return{root:e,key:t,target:n};n=e;for(let i of t.split(`-`)){var r;t=i,e=n,n=(r=n)?.[t]}return{root:e,key:t,target:n}}function Ue(e,t){if(B.str(t.props.attach)){if(It.test(t.props.attach)){let n=t.props.attach.replace(It,``),{root:r,key:i}=He(e.object,n);Array.isArray(r[i])||(r[i]=[])}let{root:n,key:r}=He(e.object,t.props.attach);t.previousAttach=n[r],n[r]=t.object}else B.fun(t.props.attach)&&(t.previousAttach=t.props.attach(e.object,t.object))}function We(e,t){if(B.str(t.props.attach)){let{root:n,key:r}=He(e.object,t.props.attach),i=t.previousAttach;i===void 0?delete n[r]:n[r]=i}else t.previousAttach==null||t.previousAttach(e.object,t.object);delete t.previousAttach}function Ge(e){let t=Rt.get(e.constructor);try{t||(t=new e.constructor,Rt.set(e.constructor,t))}catch{}return t}function Ke(e,t){let n={};for(let r in t){if(Lt.includes(r)||B.equ(t[r],e.props[r]))continue;for(let e in n[r]=t[r],t)e.startsWith(`${r}-`)&&(n[e]=t[e])}for(let r in e.props){if(Lt.includes(r)||t.hasOwnProperty(r))continue;let{root:i,key:a}=He(e.object,r);if(i.constructor&&i.constructor.length===0){let e=Ge(i);B.und(e)||(n[a]=e[a])}else n[a]=0}return n}function N(e,t){var n;let r=e.__r3f,i=r&&Ne(r).getState(),a=r?.eventCount;for(let n in t){let a=t[n];if(Lt.includes(n))continue;if(r&&Bt.test(n)){typeof a==`function`?r.handlers[n]=a:delete r.handlers[n],r.eventCount=Object.keys(r.handlers).length;continue}if(a===void 0)continue;let{root:s,key:c,target:l}=He(e,n);if(l instanceof x&&a instanceof x)l.mask=a.mask;else if(l instanceof d&&Nt(a))l.set(a);else if(typeof l==`object`&&l&&typeof l.set==`function`&&typeof l.copy==`function`&&a!=null&&a.constructor&&l.constructor===a.constructor)l.copy(a);else if(typeof l==`object`&&l&&typeof l.set==`function`&&Array.isArray(a))typeof l.fromArray==`function`?l.fromArray(a):l.set(...a);else if(typeof l==`object`&&l&&typeof l.set==`function`&&typeof a==`number`)typeof l.setScalar==`function`?l.setScalar(a):l.set(a);else{var o;s[c]=a,i&&!i.linear&&zt.includes(c)&&(o=s[c])!=null&&o.isTexture&&s[c].format===T&&s[c].type===O&&(s[c].colorSpace=ce)}}if(r!=null&&r.parent&&i!=null&&i.internal&&(n=r.object)!=null&&n.isObject3D&&a!==r.eventCount){let e=r.object,t=i.internal.interaction.indexOf(e);t>-1&&i.internal.interaction.splice(t,1),r.eventCount&&e.raycast!==null&&i.internal.interaction.push(e)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach=`geometry`:r.object.isMaterial&&(r.props.attach=`material`)),r&&P(r),e}function P(e){var t;if(!e.parent)return;e.props.onUpdate==null||e.props.onUpdate(e.object);let n=(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function qe(e,t){e.manual||(jt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix())}function Je(e){return(e.eventObject||e.object).uuid+`/`+e.index+e.instanceId}function Ye(e,t,n,r){let i=n.get(t);i&&(n.delete(t),n.size===0&&(e.delete(r),i.target.releasePointerCapture(r)))}function Xe(e,t){let{internal:n}=e.getState();n.interaction=n.interaction.filter(e=>e!==t),n.initialHits=n.initialHits.filter(e=>e!==t),n.hovered.forEach((e,r)=>{(e.eventObject===t||e.object===t)&&n.hovered.delete(r)}),n.capturedMap.forEach((e,r)=>{Ye(n.capturedMap,t,e,r)})}function Ze(e){function t(t){let{internal:n}=e.getState(),r=t.offsetX-n.initialClick[0],i=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+i*i))}function n(e){return e.filter(e=>[`Move`,`Over`,`Enter`,`Out`,`Leave`].some(t=>{var n;return(n=e.__r3f)?.handlers[`onPointer`+t]}))}function r(t,n){let r=e.getState(),i=new Set,a=[],o=n?n(r.internal.interaction):r.internal.interaction;for(let e=0;e<o.length;e++){let t=M(o[e]);t&&(t.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(t,r);function s(e){let n=M(e);if(!n||!n.events.enabled||n.raycaster.camera===null)return[];if(n.raycaster.camera===void 0){var r;n.events.compute==null||n.events.compute(t,n,(r=n.previousRoot)?.getState()),n.raycaster.camera===void 0&&(n.raycaster.camera=null)}return n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]}let c=o.flatMap(s).sort((e,t)=>{let n=M(e.object),r=M(t.object);return!n||!r?e.distance-t.distance:r.events.priority-n.events.priority||e.distance-t.distance}).filter(e=>{let t=Je(e);return i.has(t)?!1:(i.add(t),!0)});r.events.filter&&(c=r.events.filter(c,r));for(let e of c){let t=e.object;for(;t;){var l;(l=t.__r3f)!=null&&l.eventCount&&a.push({...e,eventObject:t}),t=t.parent}}if(`pointerId`in t&&r.internal.capturedMap.has(t.pointerId))for(let e of r.internal.capturedMap.get(t.pointerId).values())i.has(Je(e.intersection))||a.push(e.intersection);return a}function i(e,t,n,r){if(e.length){let i={stopped:!1};for(let o of e){let s=M(o.object);if(s||o.object.traverseAncestors(e=>{let t=M(e);if(t)return s=t,!1}),s){let{raycaster:c,pointer:l,camera:u,internal:d}=s,f=new k(l.x,l.y,0).unproject(u),p=e=>{var t,n;return(t=(n=d.capturedMap.get(e))?.has(o.eventObject))??!1},m=e=>{let n={intersection:o,target:t.target};d.capturedMap.has(e)?d.capturedMap.get(e).set(o.eventObject,n):d.capturedMap.set(e,new Map([[o.eventObject,n]])),t.target.setPointerCapture(e)},h=e=>{let t=d.capturedMap.get(e);t&&Ye(d.capturedMap,o.eventObject,t,e)},g={};for(let e in t){let n=t[e];typeof n!=`function`&&(g[e]=n)}let _={...o,...g,pointer:l,intersections:e,stopped:i.stopped,delta:n,unprojectedPoint:f,ray:c.ray,camera:u,stopPropagation(){let n=`pointerId`in t&&d.capturedMap.get(t.pointerId);if((!n||n.has(o.eventObject))&&(_.stopped=i.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find(e=>e.eventObject===o.eventObject))){let t=e.slice(0,e.indexOf(o));a([...t,o])}},target:{hasPointerCapture:p,setPointerCapture:m,releasePointerCapture:h},currentTarget:{hasPointerCapture:p,setPointerCapture:m,releasePointerCapture:h},nativeEvent:t};if(r(_),i.stopped===!0)break}}}return e}function a(t){let{internal:n}=e.getState();for(let e of n.hovered.values())if(!t.length||!t.find(t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId)){let r=e.eventObject,i=r.__r3f;if(n.hovered.delete(Je(e)),i!=null&&i.eventCount){let n=i.handlers,r={...e,intersections:t};n.onPointerOut==null||n.onPointerOut(r),n.onPointerLeave==null||n.onPointerLeave(r)}}}function o(e,t){for(let n=0;n<t.length;n++){let r=t[n].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(e)}}function s(s){switch(s){case`onPointerLeave`:case`onPointerCancel`:return()=>a([]);case`onLostPointerCapture`:return t=>{let{internal:n}=e.getState();`pointerId`in t&&n.capturedMap.has(t.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(t.pointerId)&&(n.capturedMap.delete(t.pointerId),a([]))})}}return function(c){let{onPointerMissed:l,internal:u}=e.getState();u.lastEvent.current=c;let d=s===`onPointerMove`,f=s===`onClick`||s===`onContextMenu`||s===`onDoubleClick`,p=d?n:void 0,m=r(c,p),h=f?t(c):0;s===`onPointerDown`&&(u.initialClick=[c.offsetX,c.offsetY],u.initialHits=m.map(e=>e.eventObject)),f&&!m.length&&h<=2&&(o(c,u.interaction),l&&l(c)),d&&a(m);function g(e){let t=e.eventObject,n=t.__r3f;if(!(n!=null&&n.eventCount))return;let r=n.handlers;if(d){if(r.onPointerOver||r.onPointerEnter||r.onPointerOut||r.onPointerLeave){let t=Je(e),n=u.hovered.get(t);n?n.stopped&&e.stopPropagation():(u.hovered.set(t,e),r.onPointerOver==null||r.onPointerOver(e),r.onPointerEnter==null||r.onPointerEnter(e))}r.onPointerMove==null||r.onPointerMove(e)}else{let n=r[s];n?(!f||u.initialHits.includes(t))&&(o(c,u.interaction.filter(e=>!u.initialHits.includes(e))),n(e)):f&&u.initialHits.includes(t)&&o(c,u.interaction.filter(e=>!u.initialHits.includes(e)))}}i(m,c,h,g)}}return{handlePointer:s}}function Qe(){let e=L.useContext(Ht);if(!e)throw Error(`R3F: Hooks can only be used within the Canvas component!`);return e}function F(e=e=>e,t){return Qe()(e,t)}function $e(e,t=0){let n=Qe(),r=n.getState().internal.subscribe,i=Pe(e);return z(()=>r(i,t,n),[t,r,n]),null}function et(e,t){return function(n,...r){let i;return Gt(n)?(i=Wt.get(n),i||(i=new n,Wt.set(n,i))):i=n,e&&e(i),Promise.all(r.map(e=>new Promise((n,r)=>i.load(e,e=>{V(e?.scene)&&Object.assign(e,Re(e.scene)),n(e)},t,t=>r(Error(`Could not load ${e}: ${t?.message}`))))))}}function I(e,t,n,r){let i=Array.isArray(t)?t:[t],a=je(et(n,r),[e,...i],{equal:B.equ});return Array.isArray(t)?a:a[0]}function tt(e){let t=(0,Ot.default)(e);return t.injectIntoDevTools({bundleType:0,rendererPackageName:`@react-three/fiber`,version:L.version}),t}function nt(e){if(Xt(e)){let t=`${Yt++}`;return H[t]=e,t}else Object.assign(H,e)}function rt(e,t){let n=Jt(e),r=H[n];if(e!==`primitive`&&!r)throw Error(`R3F: ${n} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(e===`primitive`&&!t.object)throw Error(`R3F: Primitives without 'object' are invalid!`);if(t.args!==void 0&&!Array.isArray(t.args))throw Error(`R3F: The args prop must be an array!`)}function it(e,t,n){var r;return e=Jt(e)in H?e:e.replace(qt,``),rt(e,t),e===`primitive`&&(r=t.object)!=null&&r.__r3f&&delete t.object.__r3f,Ve(t.object,n,e,t)}function at(e){if(!e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?We(e.parent,e):V(e.object)&&(e.object.visible=!1),e.isHidden=!0,P(e)}}function ot(e){if(e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?Ue(e.parent,e):V(e.object)&&e.props.visible!==!1&&(e.object.visible=!0),e.isHidden=!1,P(e)}}function st(e,t,n){let r=t.root.getState();if(!(!e.parent&&e.object!==r.scene)){if(!t.object){var i,a;let e=H[Jt(t.type)];t.object=(i=t.props.object)??new e(...(a=t.props.args)??[]),t.object.__r3f=t}if(N(t.object,t.props),t.props.attach)Ue(e,t);else if(V(t.object)&&V(e.object)){let r=e.object.children.indexOf(n?.object);if(n&&r!==-1){let n=e.object.children.indexOf(t.object);if(n!==-1){e.object.children.splice(n,1);let i=n<r?r-1:r;e.object.children.splice(i,0,t.object)}else t.object.parent=e.object,e.object.children.splice(r,0,t.object),t.object.dispatchEvent({type:`added`}),e.object.dispatchEvent({type:`childadded`,child:t.object})}else e.object.add(t.object)}for(let e of t.children)st(t,e);P(t)}}function ct(e,t){t&&(t.parent=e,e.children.push(t),st(e,t))}function lt(e,t,n){if(!t||!n)return;t.parent=e;let r=e.children.indexOf(n);r===-1?e.children.push(t):e.children.splice(r,0,t),st(e,t,n)}function ut(e){if(typeof e.dispose==`function`){let t=()=>{try{e.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<`u`?t():(0,kt.unstable_scheduleCallback)(kt.unstable_IdlePriority,t)}}function dt(e,t,n){if(!t)return;t.parent=null;let r=e.children.indexOf(t);r!==-1&&e.children.splice(r,1),t.props.attach?We(e,t):V(t.object)&&V(e.object)&&(e.object.remove(t.object),Xe(Ne(t),t.object));let i=t.props.dispose!==null&&n!==!1;for(let e=t.children.length-1;e>=0;e--){let n=t.children[e];dt(t,n,i)}t.children.length=0,delete t.object.__r3f,i&&t.type!==`primitive`&&t.object.type!==`Scene`&&ut(t.object),n===void 0&&P(t)}function ft(e,t){for(let n of[e,e.alternate])if(n!==null)if(typeof n.ref==`function`){n.refCleanup==null||n.refCleanup();let e=n.ref(t);typeof e==`function`&&(n.refCleanup=e)}else n.ref&&(n.ref.current=t)}function pt(){for(let[e]of Zt){let t=e.parent;if(t){e.props.attach?We(t,e):V(e.object)&&V(t.object)&&t.object.remove(e.object);for(let t of e.children)t.props.attach?We(e,t):V(t.object)&&V(e.object)&&e.object.remove(t.object)}e.isHidden&&ot(e),e.object.__r3f&&delete e.object.__r3f,e.type!==`primitive`&&ut(e.object)}for(let[n,r,i]of Zt){n.props=r;let a=n.parent;if(a){var e,t;let r=H[Jt(n.type)];n.object=(e=n.props.object)??new r(...(t=n.props.args)??[]),n.object.__r3f=n,ft(i,n.object),N(n.object,n.props),n.props.attach?Ue(a,n):V(n.object)&&V(a.object)&&a.object.add(n.object);for(let e of n.children)e.props.attach?Ue(n,e):V(e.object)&&V(n.object)&&n.object.add(e.object);P(n)}}Zt.length=0}function mt(e,t){if(!t&&typeof HTMLCanvasElement<`u`&&e instanceof HTMLCanvasElement&&e.parentElement){let{width:t,height:n,top:r,left:i}=e.parentElement.getBoundingClientRect();return{width:t,height:n,top:r,left:i}}else if(!t&&typeof OffscreenCanvas<`u`&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...t}}function ht(e){let t=U.get(e),n=t?.fiber,r=t?.store;t&&console.warn(`R3F.createRoot should only be called once!`);let i=typeof reportError==`function`?reportError:console.error,a=r||Ut(wt,Tt),o=n||rn.createContainer(a,Dt.ConcurrentRoot,null,!1,null,``,i,i,i,null);t||U.set(e,{fiber:o,store:a});let s,u,d=!1,p=null;return{async configure(t={}){let n;p=new Promise(e=>n=e);let{gl:r,size:i,scene:o,events:m,onCreated:h,shadows:g=!1,linear:_=!1,flat:v=!1,legacy:y=!1,orthographic:b=!1,frameloop:x=`always`,dpr:C=[1,2],performance:w,raycaster:te,camera:T,onPointerMissed:oe}=t,E=a.getState(),D=E.gl;if(!E.gl){let t={canvas:e,powerPreference:`high-performance`,antialias:!0,alpha:!0},n=typeof r==`function`?await r(t):r;D=Vt(n)?n:new fe({...t,...r}),E.set({gl:D})}let O=E.raycaster;O||E.set({raycaster:O=new se});let{params:de,...k}=te||{};if(B.equ(k,O,W)||N(O,{...k}),B.equ(de,O.params,W)||N(O,{params:{...O.params,...de}}),!E.camera||E.camera===u&&!B.equ(u,T,W)){u=T;let e=T?.isCamera,t=e?T:b?new ne(0,0,0,0,.1,1e3):new ae(75,0,.1,1e3);e||(t.position.z=5,T&&(N(t,T),t.manual||(`aspect`in T||`left`in T||`right`in T||`bottom`in T||`top`in T)&&(t.manual=!0,t.updateProjectionMatrix())),!E.camera&&!(T!=null&&T.rotation)&&t.lookAt(0,0,0)),E.set({camera:t}),O.camera=t}if(!E.scene){let e;o!=null&&o.isScene?(e=o,Ve(e,a,``,{})):(e=new le,Ve(e,a,``,{}),o&&N(e,o)),E.set({scene:e})}m&&!E.events.handlers&&E.set({events:m(a)});let A=mt(e,i);if(B.equ(A,E.size,W)||E.setSize(A.width,A.height,A.top,A.left),C&&E.viewport.dpr!==Le(C)&&E.setDpr(C),E.frameloop!==x&&E.setFrameloop(x),E.onPointerMissed||E.set({onPointerMissed:oe}),w&&!B.equ(w,E.performance,W)&&E.set(e=>({performance:{...e.performance,...w}})),!E.xr){var j;let e=(e,t)=>{let n=a.getState();n.frameloop!==`never`&&Tt(e,!0,n,t)},t=()=>{let t=a.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||wt(t)},n={connect(){let e=a.getState().gl;e.xr.addEventListener(`sessionstart`,t),e.xr.addEventListener(`sessionend`,t)},disconnect(){let e=a.getState().gl;e.xr.removeEventListener(`sessionstart`,t),e.xr.removeEventListener(`sessionend`,t)}};typeof(j=D.xr)?.addEventListener==`function`&&n.connect(),E.set({xr:n})}if(D.shadowMap){let e=D.shadowMap.enabled,t=D.shadowMap.type;if(D.shadowMap.enabled=!!g,B.boo(g))D.shadowMap.type=ie;else if(B.str(g)){var pe;let e={basic:l,percentage:re,soft:ie,variance:ue};D.shadowMap.type=(pe=e[g])??ie}else B.obj(g)&&Object.assign(D.shadowMap,g);(e!==D.shadowMap.enabled||t!==D.shadowMap.type)&&(D.shadowMap.needsUpdate=!0)}return f.enabled=!y,d||(D.outputColorSpace=_?S:ce,D.toneMapping=v?ee:c),E.legacy!==y&&E.set(()=>({legacy:y})),E.linear!==_&&E.set(()=>({linear:_})),E.flat!==v&&E.set(()=>({flat:v})),r&&!B.fun(r)&&!Vt(r)&&!B.equ(r,D,W)&&N(D,r),s=h,d=!0,n(),this},render(t){return!d&&!p&&this.configure(),p.then(()=>{rn.updateContainer((0,R.jsx)(gt,{store:a,children:t,onCreated:s,rootElement:e}),o,null,()=>void 0)}),a},unmount(){_t(e)}}}function gt({store:e,children:t,onCreated:n,rootElement:r}){return z(()=>{let t=e.getState();t.set(e=>({internal:{...e.internal,active:!0}})),n&&n(t),e.getState().events.connected||t.events.connect==null||t.events.connect(r)},[]),(0,R.jsx)(Ht.Provider,{value:e,children:t})}function _t(e,t){let n=U.get(e),r=n?.fiber;if(r){let i=n?.store.getState();i&&(i.internal.active=!1),rn.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var n,r,a,o;i.events.disconnect==null||i.events.disconnect(),(n=i.gl)==null||(r=n.renderLists)==null||r.dispose==null||r.dispose(),(a=i.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(o=i.gl)!=null&&o.xr&&i.xr.disconnect(),ze(i.scene),U.delete(e),t&&t(e)}catch{}},500)})}}function vt(e,t,n){return(0,R.jsx)(yt,{children:e,container:t,state:n})}function yt({state:e={},children:t,container:n}){let{events:r,size:i,...a}=e,o=Qe(),[s]=L.useState(()=>new se),[c]=L.useState(()=>new de),l=Pe((e,t)=>{let a;if(t.camera&&i){let n=t.camera;a=e.viewport.getCurrentViewport(n,new k,i),n!==e.camera&&qe(n,i)}return{...e,...t,scene:n,raycaster:s,pointer:c,mouse:c,previousRoot:o,events:{...e.events,...t.events,...r},size:{...e.size,...i},viewport:{...e.viewport,...a},setEvents:e=>t.set(t=>({...t,events:{...t.events,...e}}))}}),u=L.useMemo(()=>{let e=be((e,t)=>({...a,set:e,get:t})),t=t=>e.setState(e=>l.current(t,e));return t(o.getState()),o.subscribe(t),e},[o,n]);return(0,R.jsx)(R.Fragment,{children:rn.createPortal((0,R.jsx)(Ht.Provider,{value:u,children:t}),u,null)})}function bt(e,t){if(e.size)for(let{callback:n}of e.values())n(t)}function xt(e,t){switch(e){case`before`:return bt(an,t);case`after`:return bt(on,t);case`tail`:return bt(sn,t)}}function St(e,t,n){let r=t.clock.getDelta();t.frameloop===`never`&&typeof e==`number`&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),cn=t.internal.subscribers;for(let e=0;e<cn.length;e++)ln=cn[e],ln.ref.current(ln.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop===`always`?1:t.internal.frames}function Ct(e){pn=requestAnimationFrame(Ct),un=!0,fn=0,xt(`before`,e),dn=!0;for(let n of U.values()){var t;G=n.store.getState(),G.internal.active&&(G.frameloop===`always`||G.internal.frames>0)&&!((t=G.gl.xr)!=null&&t.isPresenting)&&(fn+=St(e,G))}if(dn=!1,xt(`after`,e),fn===0)return xt(`tail`,e),un=!1,cancelAnimationFrame(pn)}function wt(e,t=1){var n;if(!e)return U.forEach(e=>wt(e.store.getState(),t));(n=e.gl.xr)!=null&&n.isPresenting||!e.internal.active||e.frameloop===`never`||(t>1?e.internal.frames=Math.min(60,e.internal.frames+t):dn?e.internal.frames=2:e.internal.frames=1,un||(un=!0,requestAnimationFrame(Ct)))}function Tt(e,t=!0,n,r){if(t&&xt(`before`,e),n)St(e,n,r);else for(let t of U.values())St(e,t.store.getState());t&&xt(`after`,e)}function Et(e){let{handlePointer:t}=Ze(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-(e.offsetY/t.size.height)*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(mn).reduce((e,n)=>({...e,[n]:t(n)}),{}),update:()=>{var t;let{events:n,internal:r}=e.getState();(t=r.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{let{set:n,events:r}=e.getState();if(r.disconnect==null||r.disconnect(),n(e=>({events:{...e.events,connected:t}})),r.handlers)for(let e in r.handlers){let n=r.handlers[e],[i,a]=mn[e];t.addEventListener(i,n,{passive:a})}},disconnect:()=>{let{set:t,events:n}=e.getState();if(n.connected){if(n.handlers)for(let e in n.handlers){let t=n.handlers[e],[r]=mn[e];n.connected.removeEventListener(r,t)}t(e=>({events:{...e.events,connected:void 0}}))}}}}var L,Dt,Ot,kt,R,At,jt,Mt,Nt,z,Pt,B,Ft,It,Lt,Rt,zt,Bt,V,Vt,Ht,Ut,Wt,Gt,Kt,H,qt,Jt,Yt,Xt,Zt,Qt,$t,en,tn,nn,rn,U,W,an,on,sn,cn,ln,un,dn,fn,pn,G,mn,hn=e(()=>{j(),L=t(o()),Dt=t(i()),De(),Ot=t(s()),kt=t(Ae()),Ee(),R=t(a()),we(),At=L.act,jt=e=>e&&e.isOrthographicCamera,Mt=e=>e&&e.hasOwnProperty(`current`),Nt=e=>e!=null&&(typeof e==`string`||typeof e==`number`||e.isColor),z=((e,t)=>typeof window<`u`&&((e=window.document)?.createElement||(t=window.navigator)?.product===`ReactNative`))()?L.useLayoutEffect:L.useEffect,Pt=(e=>(e=class extends L.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}},e.getDerivedStateFromError=()=>({error:!0}),e))(),B={obj:e=>e===Object(e)&&!B.arr(e)&&typeof e!=`function`,fun:e=>typeof e==`function`,str:e=>typeof e==`string`,num:e=>typeof e==`number`,boo:e=>typeof e==`boolean`,und:e=>e===void 0,nul:e=>e===null,arr:e=>Array.isArray(e),equ(e,t,{arrays:n=`shallow`,objects:r=`reference`,strict:i=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(B.str(e)||B.num(e)||B.boo(e))return e===t;let a=B.obj(e);if(a&&r===`reference`)return e===t;let o=B.arr(e);if(o&&n===`reference`)return e===t;if((o||a)&&e===t)return!0;let s;for(s in e)if(!(s in t))return!1;if(a&&n===`shallow`&&r===`shallow`){for(s in i?t:e)if(!B.equ(e[s],t[s],{strict:i,objects:`reference`}))return!1}else for(s in i?t:e)if(e[s]!==t[s])return!1;if(B.und(s)){if(o&&e.length===0&&t.length===0||a&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}},Ft=[`children`,`key`,`ref`],It=/-\d+$/,Lt=[...Ft,`args`,`dispose`,`attach`,`object`,`onUpdate`,`dispose`],Rt=new Map,zt=[`map`,`emissiveMap`,`sheenColorMap`,`specularColorMap`,`envMap`],Bt=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/,V=e=>e?.isObject3D,Vt=e=>!!(e!=null&&e.render),Ht=L.createContext(null),Ut=(e,t)=>{let n=be((n,r)=>{let i=new k,a=new k,o=new k;function s(e=r().camera,t=a,n=r().size){let{width:s,height:c,top:l,left:u}=n,d=s/c;t.isVector3?o.copy(t):o.set(...t);let f=e.getWorldPosition(i).distanceTo(o);if(jt(e))return{width:s/e.zoom,height:c/e.zoom,top:l,left:u,factor:1,distance:f,aspect:d};{let t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*f,r=n*(s/c);return{width:r,height:n,top:l,left:u,factor:s/r,distance:f,aspect:d}}}let c,l=e=>n(t=>({performance:{...t.performance,current:e}})),d=new de,f={set:n,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(t=1)=>e(r(),t),advance:(e,n)=>t(e,n,r()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new u,pointer:d,mouse:d,frameloop:`always`,onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{let e=r();c&&clearTimeout(c),e.performance.current!==e.performance.min&&l(e.performance.min),c=setTimeout(()=>l(r().performance.max),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:s},setEvents:e=>n(t=>({...t,events:{...t.events,...e}})),setSize:(e,t,i=0,o=0)=>{let c=r().camera,l={width:e,height:t,top:i,left:o};n(e=>({size:l,viewport:{...e.viewport,...s(c,a,l)}}))},setDpr:e=>n(t=>{let n=Le(e);return{viewport:{...t.viewport,dpr:n,initialDpr:t.viewport.initialDpr||n}}}),setFrameloop:(e=`always`)=>{let t=r().clock;t.stop(),t.elapsedTime=0,e!==`never`&&(t.start(),t.elapsedTime=0),n(()=>({frameloop:e}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:L.createRef(),active:!1,frames:0,priority:0,subscribe:(e,t,n)=>{let i=r().internal;return i.priority+=t>0?1:0,i.subscribers.push({ref:e,priority:t,store:n}),i.subscribers=i.subscribers.sort((e,t)=>e.priority-t.priority),()=>{let n=r().internal;n!=null&&n.subscribers&&(n.priority-=t>0?1:0,n.subscribers=n.subscribers.filter(t=>t.ref!==e))}}}};return f}),r=n.getState(),i=r.size,a=r.viewport.dpr,o=r.camera;return n.subscribe(()=>{let{camera:e,size:t,viewport:r,gl:s,set:c}=n.getState();if(t.width!==i.width||t.height!==i.height||r.dpr!==a){i=t,a=r.dpr,qe(e,t),r.dpr>0&&s.setPixelRatio(r.dpr);let n=typeof HTMLCanvasElement<`u`&&s.domElement instanceof HTMLCanvasElement;s.setSize(t.width,t.height,n)}e!==o&&(o=e,c(t=>({viewport:{...t.viewport,...t.viewport.getCurrentViewport(e)}})))}),n.subscribe(t=>e(t)),n},Wt=new WeakMap,Gt=e=>{var t;return typeof e==`function`&&(e==null?void 0:(t=e.prototype)?.constructor)===e},I.preload=function(e,t,n){let r=Array.isArray(t)?t:[t];return ke(et(n),[e,...r])},I.clear=function(e,t){let n=Array.isArray(t)?t:[t];return ye([e,...n])},Kt=0,H={},qt=/^three(?=[A-Z])/,Jt=e=>`${e[0].toUpperCase()}${e.slice(1)}`,Yt=0,Xt=e=>typeof e==`function`,Zt=[],Qt=()=>{},$t={},en=Kt,tn=0,nn=4,rn=tt({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:it,removeChild:dt,appendChild:ct,appendInitialChild:ct,insertBefore:lt,appendChildToContainer(e,t){let n=e.getState().scene.__r3f;!t||!n||ct(n,t)},removeChildFromContainer(e,t){let n=e.getState().scene.__r3f;!t||!n||dt(n,t)},insertInContainerBefore(e,t,n){let r=e.getState().scene.__r3f;!t||!n||!r||lt(r,t,n)},getRootHostContext:()=>$t,getChildHostContext:()=>$t,commitUpdate(e,t,n,r,i){var a,o,s;rt(t,r);let c=!1;if(e.type===`primitive`&&n.object!==r.object?c=!0:(a=r.args)?.length===(o=n.args)?.length?(s=r.args)!=null&&s.some((e,t)=>{var r;return e!==(r=n.args)?.[t]})&&(c=!0):c=!0,c)Zt.push([e,{...r},i]);else{let t=Ke(e,r);Object.keys(t).length&&(Object.assign(e.props,t),N(e.object,t))}let l=i.sibling===null||(i.flags&nn)===tn;l&&pt()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:e=>e?.object,prepareForCommit:()=>null,preparePortalMount:e=>Ve(e.getState().scene,e,``,{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:at,unhideInstance:ot,createTextInstance:Qt,hideTextInstance:Qt,unhideTextInstance:Qt,scheduleTimeout:typeof setTimeout==`function`?setTimeout:void 0,cancelTimeout:typeof clearTimeout==`function`?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:L.createContext(null),setCurrentUpdatePriority(e){en=e},getCurrentUpdatePriority(){return en},resolveUpdatePriority(){var e;if(en!==Kt)return en;switch(typeof window<`u`&&(e=window.event)?.type){case`click`:case`contextmenu`:case`dblclick`:case`pointercancel`:case`pointerdown`:case`pointerup`:return Dt.DiscreteEventPriority;case`pointermove`:case`pointerout`:case`pointerover`:case`pointerenter`:case`pointerleave`:case`wheel`:return Dt.ContinuousEventPriority;default:return Dt.DefaultEventPriority}},resetFormInstance(){}}),U=new Map,W={objects:`shallow`,strict:!1},an=new Set,on=new Set,sn=new Set,un=!1,dn=!1,mn={onClick:[`click`,!1],onContextMenu:[`contextmenu`,!1],onDoubleClick:[`dblclick`,!1],onWheel:[`wheel`,!0],onPointerDown:[`pointerdown`,!0],onPointerUp:[`pointerup`,!0],onPointerLeave:[`pointerleave`,!0],onPointerMove:[`pointermove`,!0],onPointerCancel:[`pointercancel`,!0],onLostPointerCapture:[`lostpointercapture`,!0]}});function gn({ref:e,children:t,fallback:n,resize:i,style:a,gl:o,events:s=Et,eventSource:c,eventPrefix:l,shadows:u,linear:d,flat:f,legacy:p,orthographic:m,frameloop:h,dpr:g,performance:_,raycaster:v,camera:y,scene:b,onPointerMissed:x,onCreated:S,...C}){K.useMemo(()=>nt(me),[]);let w=Fe(),[ee,te]=r({scroll:!0,debounce:{scroll:50,resize:0},...i}),ne=K.useRef(null),re=K.useRef(null);K.useImperativeHandle(e,()=>ne.current);let ie=Pe(x),[ae,T]=K.useState(!1),[oe,se]=K.useState(!1);if(ae)throw ae;if(oe)throw oe;let ce=K.useRef(null);z(()=>{let e=ne.current;if(te.width>0&&te.height>0&&e){ce.current||=ht(e);async function n(){await ce.current.configure({gl:o,scene:b,events:s,shadows:u,linear:d,flat:f,legacy:p,orthographic:m,frameloop:h,dpr:g,performance:_,raycaster:v,camera:y,size:te,onPointerMissed:(...e)=>ie.current==null?void 0:ie.current(...e),onCreated:e=>{e.events.connect==null||e.events.connect(c?Mt(c)?c.current:c:re.current),l&&e.setEvents({compute:(e,t)=>{let n=e[l+`X`],r=e[l+`Y`];t.pointer.set(n/t.size.width*2-1,-(r/t.size.height)*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),S?.(e)}}),ce.current.render((0,q.jsx)(w,{children:(0,q.jsx)(Pt,{set:se,children:(0,q.jsx)(K.Suspense,{fallback:(0,q.jsx)(Ie,{set:T}),children:t??null})})}))}n()}}),K.useEffect(()=>{let e=ne.current;if(e)return()=>_t(e)},[]);let le=c?`none`:`auto`;return(0,q.jsx)(`div`,{ref:re,style:{position:`relative`,width:`100%`,height:`100%`,overflow:`hidden`,pointerEvents:le,...a},...C,children:(0,q.jsx)(`div`,{ref:ee,style:{width:`100%`,height:`100%`},children:(0,q.jsx)(`canvas`,{ref:ne,style:{display:`block`},children:n})})})}function _n(e){return(0,q.jsx)(Oe,{children:(0,q.jsx)(gn,{...e})})}var K,q,vn,yn,bn,J=e(()=>{hn(),K=t(o()),j(),n(),we(),q=t(a()),vn=t(i()),yn=t(s()),bn=t(Ae())});function xn(e,t){let n=F(e=>e.gl),r=I(D,wn(e)?Object.values(e):e);(0,Cn.useLayoutEffect)(()=>{t?.(r)},[t]),(0,Cn.useEffect)(()=>{if(`initTexture`in n){let e=[];Array.isArray(r)?e=r:r instanceof E?e=[r]:wn(r)&&(e=Object.values(r)),e.forEach(e=>{e instanceof E&&n.initTexture(e)})}},[n,r]);let i=(0,Cn.useMemo)(()=>{if(wn(e)){let t={},n=0;for(let i in e)t[i]=r[n++];return t}else return r},[e,r]);return i}var Sn,Cn,wn,Tn=e(()=>{Sn=t(o()),Cn=t(o()),j(),J(),wn=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!=`function`,xn.preload=e=>I.preload(D,e),xn.clear=e=>I.clear(D,e)});function En(e=!0,t=!0,n){return r=>{n&&n(r),e&&(On||=new h,On.setDecoderPath(typeof e==`string`?e:kn),r.setDRACOLoader(On)),t&&r.setMeshoptDecoder(typeof w==`function`?w():w)}}var Dn,On,kn,An,jn=e(()=>{Dn=t(o()),pe(),J(),On=null,kn=`https://www.gstatic.com/draco/versioned/decoders/1.5.5/`,An=(e,t,n,r)=>I(v,e,En(t,n,r)),An.preload=(e,t,n,r)=>I.preload(v,e,En(t,n,r)),An.clear=e=>I.clear(v,e),An.setDecoderPath=e=>{kn=e}}),Y,Mn,Nn=e(()=>{Te(),J(),Y=t(o()),pe(),Mn=Y.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:r,enableDamping:i=!0,keyEvents:a=!1,onChange:o,onStart:s,onEnd:c,...l},u)=>{let d=F(e=>e.invalidate),f=F(e=>e.camera),p=F(e=>e.gl),m=F(e=>e.events),h=F(e=>e.setEvents),g=F(e=>e.set),_=F(e=>e.get),v=F(e=>e.performance),y=t||f,b=r||m.connected||p.domElement,x=Y.useMemo(()=>new te(y),[y]);return $e(()=>{x.enabled&&x.update()},-1),Y.useEffect(()=>(a&&x.connect(a===!0?b:a),x.connect(b),()=>void x.dispose()),[a,b,n,x,d]),Y.useEffect(()=>{let e=e=>{d(),n&&v.regress(),o&&o(e)},t=e=>{s&&s(e)},r=e=>{c&&c(e)};return x.addEventListener(`change`,e),x.addEventListener(`start`,t),x.addEventListener(`end`,r),()=>{x.removeEventListener(`start`,t),x.removeEventListener(`end`,r),x.removeEventListener(`change`,e)}},[o,s,c,x,d,h]),Y.useEffect(()=>{if(e){let e=_().controls;return g({controls:x}),()=>g({controls:e})}},[e,x]),Y.createElement(`primitive`,_e({ref:u,object:x,enableDamping:i},l))})}),X,Pn,Fn=e(()=>{X=t(o()),J(),j(),Pn=X.forwardRef(({children:e,enabled:t=!0,speed:n=1,rotationIntensity:r=1,floatIntensity:i=1,floatingRange:a=[-.1,.1],autoInvalidate:o=!1,...s},c)=>{let l=X.useRef(null);X.useImperativeHandle(c,()=>l.current,[]);let u=X.useRef(Math.random()*1e4);return $e(e=>{var s,c;if(!t||n===0)return;o&&e.invalidate();let d=u.current+e.clock.elapsedTime;l.current.rotation.x=Math.cos(d/4*n)/8*r,l.current.rotation.y=Math.sin(d/4*n)/8*r,l.current.rotation.z=Math.sin(d/4*n)/20*r;let f=Math.sin(d/4*n)/10;f=C.mapLinear(f,-.1,.1,(s=a?.[0])??-.1,(c=a?.[1])??.1),l.current.position.y=f*i,l.current.updateMatrix()}),X.createElement(`group`,s,X.createElement(`group`,{ref:l,matrixAutoUpdate:!1},e))})}),Z,In=e(()=>{Z={apartment:`lebombo_1k.hdr`,city:`potsdamer_platz_1k.hdr`,dawn:`kiara_1_dawn_1k.hdr`,forest:`forest_slope_1k.hdr`,lobby:`st_fagans_interior_1k.hdr`,night:`dikhololo_night_1k.hdr`,park:`rooitou_park_1k.hdr`,studio:`studio_small_03_1k.hdr`,sunset:`venice_sunset_1k.hdr`,warehouse:`empty_warehouse_01_1k.hdr`}});function Ln({files:e=Un,path:t=``,preset:n=void 0,colorSpace:r=void 0,extensions:i}={}){n&&(Rn(n),e=Z[n],t=Hn);let a=Q(e),{extension:o,isCubemap:s}=zn(e),c=Bn(o);if(!c)throw Error(`useEnvironment: Unrecognized file extension: `+e);let l=F(e=>e.gl);(0,Vn.useLayoutEffect)(()=>{if(o!==`webp`&&o!==`jpg`&&o!==`jpeg`)return;function t(){I.clear(c,a?[e]:e)}l.domElement.addEventListener(`webglcontextlost`,t,{once:!0})},[e,l.domElement]);let u=I(c,a?[e]:e,e=>{(o===`webp`||o===`jpg`||o===`jpeg`)&&e.setRenderer(l),e.setPath==null||e.setPath(t),i&&i(e)}),d=a?u[0]:u;if(o===`jpg`||o===`jpeg`||o===`webp`){var f;d=(f=d.renderTarget)?.texture}return d.mapping=s?p:_,d.colorSpace=r??(s?`srgb`:`srgb-linear`),d}function Rn(e){if(!(e in Z))throw Error(`Preset must be one of: `+Object.keys(Z).join(`, `))}function zn(e){var t;let n=Q(e)&&e.length===6,r=Q(e)&&e.length===3&&e.some(e=>e.endsWith(`json`)),i=Q(e)?e[0]:e,a=n?`cube`:r?`webp`:i.startsWith(`data:application/exr`)?`exr`:i.startsWith(`data:application/hdr`)?`hdr`:i.startsWith(`data:image/jpeg`)?`jpg`:(t=i.split(`.`).pop())==null||(t=t.split(`?`))==null||(t=t.shift())==null?void 0:t.toLowerCase();return{extension:a,isCubemap:n,isGainmap:r}}function Bn(e){let t=e===`cube`?m:e===`hdr`?oe:e===`exr`?g:e===`jpg`||e===`jpeg`?ge:e===`webp`?he:null;return t}var Vn,Hn,Q,Un,Wn,Gn,Kn=e(()=>{J(),j(),pe(),Ce(),In(),Vn=t(o()),Hn=`https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/`,Q=e=>Array.isArray(e),Un=[`/px.png`,`/nx.png`,`/py.png`,`/ny.png`,`/pz.png`,`/nz.png`],Wn={files:Un,path:``,preset:void 0,extensions:void 0},Ln.preload=e=>{let t={...Wn,...e},{files:n,path:r=``}=t,{preset:i,extensions:a}=t;i&&(Rn(i),n=Z[i],r=Hn);let{extension:o}=zn(n);if(o===`webp`||o===`jpg`||o===`jpeg`)throw Error(`useEnvironment: Preloading gainmaps is not supported`);let s=Bn(o);if(!s)throw Error(`useEnvironment: Unrecognized file extension: `+n);I.preload(s,Q(n)?[n]:n,e=>{e.setPath==null||e.setPath(r),a&&a(e)})},Gn={files:Un,preset:void 0},Ln.clear=e=>{let t={...Gn,...e},{files:n}=t,{preset:r}=t;r&&(Rn(r),n=Z[r]);let{extension:i}=zn(n),a=Bn(i);if(!a)throw Error(`useEnvironment: Unrecognized file extension: `+n);I.clear(a,Q(n)?[n]:n)}});function qn(e,t,n,r,i={}){var a,o,s,c;i={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...i};let l=er(t||n),u=l.background,d=l.environment,f={backgroundBlurriness:l.backgroundBlurriness,backgroundIntensity:l.backgroundIntensity,backgroundRotation:(a=(o=l.backgroundRotation)==null||o.clone==null?void 0:o.clone())??[0,0,0],environmentIntensity:l.environmentIntensity,environmentRotation:(s=(c=l.environmentRotation)==null||c.clone==null?void 0:c.clone())??[0,0,0]};return e!==`only`&&(l.environment=r),e&&(l.background=r),N(l,i),()=>{e!==`only`&&(l.environment=d),e&&(l.background=u),N(l,f)}}function Jn({scene:e,background:t=!1,map:n,...r}){let i=F(e=>e.scene);return $.useLayoutEffect(()=>{if(n)return qn(t,e,i,n,r)}),null}function Yn({background:e=!1,scene:t,blur:n,backgroundBlurriness:r,backgroundIntensity:i,backgroundRotation:a,environmentIntensity:o,environmentRotation:s,...c}){let l=Ln(c),u=F(e=>e.scene);return $.useLayoutEffect(()=>qn(e,t,u,l,{backgroundBlurriness:n??r,backgroundIntensity:i,backgroundRotation:a,environmentIntensity:o,environmentRotation:s})),$.useEffect(()=>()=>{l.dispose()},[l]),null}function Xn({children:e,near:t=.1,far:n=1e3,resolution:r=256,frames:i=1,map:a,background:o=!1,blur:s,backgroundBlurriness:c,backgroundIntensity:l,backgroundRotation:u,environmentIntensity:d,environmentRotation:f,scene:p,files:m,path:h,preset:g=void 0,extensions:_}){let v=F(e=>e.gl),y=F(e=>e.scene),x=$.useRef(null),[S]=$.useState(()=>new le),C=$.useMemo(()=>{let e=new A(r);return e.texture.type=b,e},[r]);$.useEffect(()=>()=>{C.dispose()},[C]),$.useLayoutEffect(()=>{if(i===1){let e=v.autoClear;v.autoClear=!0,x.current.update(v,S),v.autoClear=e}return qn(o,p,y,C.texture,{backgroundBlurriness:s??c,backgroundIntensity:l,backgroundRotation:u,environmentIntensity:d,environmentRotation:f})},[e,S,C.texture,p,y,o,i,v]);let w=1;return $e(()=>{if(i===1/0||w<i){let e=v.autoClear;v.autoClear=!0,x.current.update(v,S),v.autoClear=e,w++}}),$.createElement($.Fragment,null,vt($.createElement($.Fragment,null,e,$.createElement(`cubeCamera`,{ref:x,args:[t,n,C]}),m||g?$.createElement(Yn,{background:!0,files:m,preset:g,path:h,extensions:_}):a?$.createElement(Jn,{background:!0,map:a,extensions:_}):null),S))}function Zn(e){var t,n,r,i;let a=Ln(e),o=e.map||a;$.useMemo(()=>nt({GroundProjectedEnvImpl:y}),[]),$.useEffect(()=>()=>{a.dispose()},[a]);let s=$.useMemo(()=>[o],[o]),c=(t=e.ground)?.height,l=(n=e.ground)?.radius,u=(r=(i=e.ground)?.scale)??1e3;return $.createElement($.Fragment,null,$.createElement(Jn,_e({},e,{map:o})),$.createElement(`groundProjectedEnvImpl`,{args:s,scale:u,height:c,radius:l}))}function Qn(e){return e.ground?$.createElement(Zn,e):e.map?$.createElement(Jn,e):e.children?$.createElement(Xn,e):$.createElement(Yn,e)}var $,$n,er,tr=e(()=>{Te(),$=t(o()),J(),j(),pe(),Kn(),$n=e=>e.current&&e.current.isScene,er=e=>$n(e)?e.current:e}),nr=e(()=>{jn(),Nn(),Se(),Tn(),Fn(),tr()});export{_n as Canvas,Qn as Environment,Pn as Float,Mn as OrbitControls,vt as createPortal,nt as extend,nr as init_drei,J as init_react_three_fiber_esm,$e as useFrame,An as useGLTF,xn as useTexture,F as useThree};